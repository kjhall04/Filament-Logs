{% extends "base.html" %}

{% block title %}Settings | Filament Logs{% endblock %}

{% block head_extra %}
<style>
    .settings-form .form-label {
        font-weight: 600;
    }

    .settings-form .form-select {
        cursor: pointer;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 10'%3e%3cpath fill='%23201870' d='M1.5 1.5L8 8l6.5-6.5L16 3 8 10 0 3z'/%3e%3c/svg%3e");
        background-size: 0.9rem;
    }

    .settings-form input[type="number"] {
        font-variant-numeric: tabular-nums;
    }

    .settings-form input[type="number"]::-webkit-outer-spin-button,
    .settings-form input[type="number"]::-webkit-inner-spin-button {
        opacity: 1;
        margin: 0;
        cursor: pointer;
        border-left: 1px solid var(--app-border);
        background: linear-gradient(
            180deg,
            rgba(var(--app-accent-rgb), 0.14),
            rgba(var(--app-accent-2-rgb), 0.2)
        );
    }

    .settings-form .form-check-input,
    .settings-form .form-check-label {
        cursor: pointer;
    }

    html[data-theme="dark"] .settings-form .form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 10'%3e%3cpath fill='%23b6c0ff' d='M1.5 1.5L8 8l6.5-6.5L16 3 8 10 0 3z'/%3e%3c/svg%3e");
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mb-3">Settings</h1>

<form method="post" class="card p-3 p-md-4 settings-form">
    <div class="row g-3">
        <div class="col-md-6">
            <label for="theme" class="form-label">Theme</label>
            <select class="form-select" id="theme" name="theme">
                {% for option in theme_options %}
                <option value="{{ option }}" {% if settings.theme == option %}selected{% endif %}>{{ option|capitalize }}</option>
                {% endfor %}
            </select>
            <small class="form-text">Switch between light and dark mode.</small>
        </div>

        <div class="col-md-6">
            <label for="alert_mode" class="form-label">Alert Handling</label>
            <select class="form-select" id="alert_mode" name="alert_mode">
                {% for option in alert_mode_options %}
                <option value="{{ option }}" {% if settings.alert_mode == option %}selected{% endif %}>
                    {% if option == 'all' %}Show all banners{% endif %}
                    {% if option == 'errors_only' %}Only show errors{% endif %}
                    {% if option == 'silent' %}Silent mode{% endif %}
                    {% if option == 'browser' %}Browser notifications{% endif %}
                </option>
                {% endfor %}
            </select>
            <small class="form-text">Controls how alerts are surfaced in the UI.</small>
        </div>

        <div class="col-md-6">
            <label for="rows_per_page" class="form-label">Rows Per Page</label>
            <input type="number" min="5" max="200" class="form-control" id="rows_per_page" name="rows_per_page" value="{{ settings.rows_per_page }}">
            <small class="form-text">Used on the inventory page pagination.</small>
        </div>

        <div class="col-md-6">
            <label for="default_location" class="form-label">Default New-Roll Location</label>
            <select class="form-select" id="default_location" name="default_location">
                <option value="Lab" {% if settings.default_location == 'Lab' %}selected{% endif %}>Lab</option>
                <option value="Storage" {% if settings.default_location == 'Storage' %}selected{% endif %}>Storage</option>
            </select>
        </div>

        <div class="col-md-6">
            <label for="popular_weeks" class="form-label">Default Popular Window (weeks)</label>
            <input type="number" min="0" max="104" class="form-control" id="popular_weeks" name="popular_weeks" value="{{ settings.popular_weeks }}">
            <small class="form-text">Set to 0 to show all-time popularity by default.</small>
        </div>

        <div class="col-md-6">
            <label for="filament_amount_g" class="form-label">Configured Filament Amount (g)</label>
            <input type="number" min="100" max="10000" step="0.01" class="form-control" id="filament_amount_g" name="filament_amount_g" value="{{ settings.filament_amount_g }}">
            <small class="form-text">Used when calculating roll weight during new-roll creation.</small>
        </div>

        <div class="col-12">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="low_stock_alerts" name="low_stock_alerts" {% if settings.low_stock_alerts %}checked{% endif %}>
                <label class="form-check-label" for="low_stock_alerts">
                    Enable low-stock warnings after logging usage
                </label>
            </div>
        </div>

        <div class="col-12 d-flex justify-content-between align-items-center mt-2">
            <button type="submit" class="btn btn-primary">Save Settings</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Inventory</a>
        </div>
    </div>
</form>

<div class="card mt-3 p-3">
    <h2 class="h5 mb-2">More Settings</h2>
    <p class="mb-0 text-muted">This page is structured to support additional preferences later (notifications, printer profiles, export behavior, and more).</p>
</div>
{% endblock %}
