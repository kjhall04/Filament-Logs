{% extends "base.html" %}

{% block title %}Report Bug | Filament Logs{% endblock %}

{% block head_extra %}
<style>
    .navbar {
        margin-top: 0.75rem;
    }

    @media (max-width: 991.98px) {
        .navbar {
            margin-top: 0.5rem;
        }
    }

    .bug-report-form .form-label {
        font-weight: 600;
    }

    .bug-report-form textarea {
        min-height: 8rem;
    }

    .bug-report-help {
        border: 1px dashed var(--app-border);
        border-radius: 0.8rem;
        background-color: var(--app-surface-soft);
        padding: 0.9rem 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="app-page">
    <div class="app-page-header">
        <h1 class="app-page-title">Report a Bug</h1>
    </div>
    <p class="app-page-meta">
        Submit details about issues you find. Reports are saved with your current app version and timestamp.
    </p>

    <form method="post" class="app-page-panel bug-report-form">
        <div class="row g-3">
            <div class="col-md-4">
                <label for="severity" class="form-label">Severity</label>
                <select class="form-select" id="severity" name="severity">
                    {% for option in severity_options %}
                    <option value="{{ option }}" {% if form_data.severity == option %}selected{% endif %}>{{ option|capitalize }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-8">
                <label for="title" class="form-label">Title</label>
                <input
                    type="text"
                    class="form-control"
                    id="title"
                    name="title"
                    maxlength="180"
                    required
                    value="{{ form_data.title }}"
                    placeholder="Short summary of the problem"
                >
            </div>

            <div class="col-12">
                <label for="description" class="form-label">Description</label>
                <textarea
                    class="form-control"
                    id="description"
                    name="description"
                    required
                    placeholder="What happened? Include what you were trying to do."
                >{{ form_data.description }}</textarea>
            </div>

            <div class="col-md-6">
                <label for="steps_to_reproduce" class="form-label">Steps to Reproduce</label>
                <textarea
                    class="form-control"
                    id="steps_to_reproduce"
                    name="steps_to_reproduce"
                    placeholder="1. ...&#10;2. ...&#10;3. ..."
                >{{ form_data.steps_to_reproduce }}</textarea>
            </div>

            <div class="col-md-6">
                <label for="expected_behavior" class="form-label">Expected Behavior</label>
                <textarea
                    class="form-control"
                    id="expected_behavior"
                    name="expected_behavior"
                    placeholder="What should have happened?"
                >{{ form_data.expected_behavior }}</textarea>
            </div>

            <div class="col-12">
                <label for="actual_behavior" class="form-label">Actual Behavior</label>
                <textarea
                    class="form-control"
                    id="actual_behavior"
                    name="actual_behavior"
                    placeholder="What happened instead?"
                >{{ form_data.actual_behavior }}</textarea>
            </div>

            <div class="col-12">
                <label for="contact" class="form-label">Contact (optional)</label>
                <input
                    type="text"
                    class="form-control"
                    id="contact"
                    name="contact"
                    maxlength="250"
                    value="{{ form_data.contact }}"
                    placeholder="Email or name for follow-up"
                >
            </div>
        </div>

        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mt-4">
            <button type="submit" class="btn btn-primary">Submit Bug Report</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Inventory</a>
        </div>
    </form>

    <section class="bug-report-help">
        <p class="mb-1">
            Stored report file:
            <code>GUI/data/bug_reports.jsonl</code>
            (or <code>BUG_REPORTS_PATH</code> if configured)
        </p>
        {% if external_bug_report_url %}
        <p class="mb-0">
            External tracker:
            <a href="{{ external_bug_report_url }}" target="_blank" rel="noopener noreferrer">Open bug tracker</a>
        </p>
        {% else %}
        <p class="mb-0 text-muted">
            Set <code>BUG_REPORT_URL</code> to show an external tracker link here.
        </p>
        {% endif %}
    </section>
</div>

{% endblock %}
